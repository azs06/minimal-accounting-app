###
# API Test Requests
# Base URL: http://127.0.0.1:8080
###

@authToken =
@companyId =

# =========================================
# User Management (from main.py and user_bp.py)
# =========================================

### Register a new user (from main.py)
POST http://127.0.0.1:8080/api/register
Content-Type: application/json

{
  "username": "testuser1",
  "password": "password123",
  "email": "testuser1@example.com"
  # "role": "user" # System-level role, might be set by default or by admin
}

### Register an admin user (from main.py)
POST http://127.0.0.1:8080/api/register
Content-Type: application/json

{
  "username": "adminuser",
  "password": "adminpassword",
  "email": "admin@example.com"
  # "role": "system_admin" # System-level role
}

### Login user (from main.py)
POST http://127.0.0.1:8080/api/login
Content-Type: application/json

{
  "username": "testuser1",
  "password": "password123"
}
@authToken = {{login_user.response.headers.Authorization}}
# @authToken = Bearer {{login_user.response.body.access_token}} # Adjust based on your auth response

### Create a new user (using user_bp.py, assuming MOCK_USER_ID or future auth)
# Note: The /api/register route is likely preferred for initial user creation.
# This /api/users POST might be for system_admin-driven creation of any user.
POST http://127.0.0.1:8080/api/users
Content-Type: application/json

{
  "username": "anotheruser",
  "email": "another@example.com",
  "password": "securepassword",
  "role": "user" # System-level role
}
@createdUserId = {{create_user.response.body.id}}

### Get all users
GET http://127.0.0.1:8080/api/users
Authorization: {{authToken}}

### Get a specific user (replace {{createdUserId}} or use a known ID)
GET http://127.0.0.1:8080/api/users/{{createdUserId}}
Authorization: {{authToken}}

### Update a user (replace {{createdUserId}} or use a known ID)
PUT http://127.0.0.1:8080/api/users/{{createdUserId}}
Authorization: {{authToken}}
Content-Type: application/json

{
  "username": "anotheruser_updated",
  "email": "another_updated@example.com",
  "role": "user" # System-level role
}

### Delete a user (replace {{createdUserId}} or use a known ID)
# DELETE http://127.0.0.1:8080/api/users/{{createdUserId}}
# Authorization: {{authToken}}


# =========================================
# Company Management
# =========================================

### Create a new company (Authenticated user becomes the owner)
POST http://127.0.0.1:8080/api/companies
Authorization: {{authToken}}
Content-Type: application/json

{
  "name": "My Awesome SaaS Business Inc."
}
@companyId = {{create_a_new_company.response.body.id}}

### Get all companies for the authenticated user (owned or member of)
GET http://127.0.0.1:8080/api/companies
Authorization: {{authToken}}

### Get a specific company
GET http://127.0.0.1:8080/api/companies/{{companyId}}
Authorization: {{authToken}}

### Update a company (Only owner/company admin)
PUT http://127.0.0.1:8080/api/companies/{{companyId}}
Authorization: {{authToken}}
Content-Type: application/json

{
  "name": "My Awesome SaaS Business Ltd."
}

### Add a user to a company (Only company owner/admin)
# Assuming 'anotheruser' (ID: {{createdUserId}}) was created earlier
POST http://127.0.0.1:8080/api/companies/{{companyId}}/users
Authorization: {{authToken}}
Content-Type: application/json

{
  "user_id": {{createdUserId}},
  "role_in_company": "editor" # e.g., admin, editor, viewer
}

### List users in a company
GET http://127.0.0.1:8080/api/companies/{{companyId}}/users
Authorization: {{authToken}}

### Remove a user from a company (Only company owner/admin)
# DELETE http://127.0.0.1:8080/api/companies/{{companyId}}/users/{{createdUserId}}
# Authorization: {{authToken}}

### Delete a company (Only owner)
# DELETE http://127.0.0.1:8080/api/companies/{{companyId}}
# Authorization: {{authToken}}

# =========================================
# Employee Management
# (Scoped to a company)
# =========================================

### Add a new employee
POST http://127.0.0.1:8080/api/companies/{{companyId}}/employees
Authorization: {{authToken}}
Content-Type: application/json

{
  "first_name": "Jane",
  "last_name": "Doette",
  "email": "jane.doette@example.com",
  "phone_number": "555-0101",
  "position": "Software Engineer",
  "hire_date": "2023-01-15",
  "is_active": true
}
@employeeId = {{add_employee.response.body.id}}

### Get all employees
GET http://127.0.0.1:8080/api/companies/{{companyId}}/employees
Authorization: {{authToken}}

### Get a specific employee
GET http://127.0.0.1:8080/api/companies/{{companyId}}/employees/{{employeeId}}
Authorization: {{authToken}}

### Update an employee
PUT http://127.0.0.1:8080/api/companies/{{companyId}}/employees/{{employeeId}}
Authorization: {{authToken}}
Content-Type: application/json

{
  "position": "Senior Software Engineer",
  "phone_number": "555-0102"
}

### Add salary for an employee
# Note: The 'recorded_by_user_id' should be set by the backend based on the authenticated user.
POST http://127.0.0.1:8080/api/companies/{{companyId}}/employees/{{employeeId}}/salaries
Authorization: {{authToken}}
Content-Type: application/json

{
  "payment_date": "2023-02-28",
  "gross_amount": 5000.00,
  "deductions": 500.00,
  "payment_period_start": "2023-02-01",
  "payment_period_end": "2023-02-28",
  "notes": "February Salary"
  # "recorded_by_user_id": 1 # Backend should fill this with authenticated user's ID
}
@salaryId = {{add_salary_for_employee.response.body.id}}

### Get all salaries for an employee
GET http://127.0.0.1:8080/api/companies/{{companyId}}/employees/{{employeeId}}/salaries
Authorization: {{authToken}}

### Get a specific salary record
# This endpoint might remain global if salary IDs are unique across the system,
# but the backend MUST ensure the salary belongs to an employee of an accessible company.
GET http://127.0.0.1:8080/api/salaries/{{salaryId}}
Authorization: {{authToken}}

### Update a salary record
PUT http://127.0.0.1:8080/api/salaries/{{salaryId}}
Authorization: {{authToken}}
Content-Type: application/json

{
  "notes": "February Salary (Corrected)"
}

### Delete a salary record
# DELETE http://127.0.0.1:8080/api/salaries/{{salaryId}}
# Authorization: {{authToken}}

### Delete an employee
# DELETE http://127.0.0.1:8080/api/companies/{{companyId}}/employees/{{employeeId}}
# Authorization: {{authToken}}

# =========================================
# Inventory Management
# (Scoped to a company)
# =========================================

### Add a new inventory item
POST http://127.0.0.1:8080/api/companies/{{companyId}}/inventory
Authorization: {{authToken}}
Content-Type: application/json

{
  "name": "Super Widget",
  "description": "A very super widget for all your widgeting needs.",
  "sku": "WDGT-SPR-001",
  "purchase_price": 10.50,
  "sale_price": 25.99,
  "quantity_on_hand": 100,
  "unit_of_measure": "pcs"
}
@inventoryItemId = {{add_inventory_item.response.body.id}}

### Get all inventory items
GET http://127.0.0.1:8080/api/companies/{{companyId}}/inventory
Authorization: {{authToken}}

### Get a specific inventory item
GET http://127.0.0.1:8080/api/companies/{{companyId}}/inventory/{{inventoryItemId}}
Authorization: {{authToken}}

### Update an inventory item
PUT http://127.0.0.1:8080/api/companies/{{companyId}}/inventory/{{inventoryItemId}}
Authorization: {{authToken}}
Content-Type: application/json

{
  "sale_price": 27.50,
  "quantity_on_hand": 95
}

### Delete an inventory item
# DELETE http://127.0.0.1:8080/api/companies/{{companyId}}/inventory/{{inventoryItemId}}
# Authorization: {{authToken}}

# =========================================
# Income Management
# (Scoped to a company)
# =========================================

### Add an income record
# Note: The 'user_id' should be set by the backend based on the authenticated user.
POST http://127.0.0.1:8080/api/companies/{{companyId}}/income
Authorization: {{authToken}}
Content-Type: application/json

{
  "description": "Consulting services for Project X",
  "amount": 1200.00,
  "date_received": "2023-03-10",
  "category": "Consulting",
  "notes": "Invoice #INV-2023-001"
  # "user_id": 1 # Backend should fill this with authenticated user's ID
}
@incomeId = {{add_income_record.response.body.id}}

### Get all income records
GET http://127.0.0.1:8080/api/companies/{{companyId}}/income
Authorization: {{authToken}}

### Get a specific income record
GET http://127.0.0.1:8080/api/companies/{{companyId}}/income/{{incomeId}}
Authorization: {{authToken}}

### Update an income record
PUT http://127.0.0.1:8080/api/companies/{{companyId}}/income/{{incomeId}}
Authorization: {{authToken}}
Content-Type: application/json

{
  "amount": 1250.00,
  "notes": "Invoice #INV-2023-001 (Revised)"
}

### Delete an income record
# DELETE http://127.0.0.1:8080/api/companies/{{companyId}}/income/{{incomeId}}
# Authorization: {{authToken}}

# =========================================
# Expense Management
# (Scoped to a company)
# =========================================

### Add an expense record
POST http://127.0.0.1:8080/api/companies/{{companyId}}/expenses
Authorization: {{authToken}}
Content-Type: application/json

{
  "description": "Office supplies purchase",
  "amount": 75.50,
  "date_incurred": "2023-03-05",
  "category": "Office Supplies",
  "vendor": "Staples",
  "notes": "Receipt #12345"
  # "user_id": 1 # Backend should fill this with authenticated user's ID
}
@expenseId = {{add_expense_record.response.body.id}}

### Get all expense records
GET http://127.0.0.1:8080/api/companies/{{companyId}}/expenses
Authorization: {{authToken}}

### Get a specific expense record
GET http://127.0.0.1:8080/api/companies/{{companyId}}/expenses/{{expenseId}}
Authorization: {{authToken}}

### Update an expense record
PUT http://127.0.0.1:8080/api/companies/{{companyId}}/expenses/{{expenseId}}
Authorization: {{authToken}}
Content-Type: application/json

{
  "amount": 80.00,
  "notes": "Receipt #12345 (Added missing item)"
}

### Delete an expense record
# DELETE http://127.0.0.1:8080/api/companies/{{companyId}}/expenses/{{expenseId}}
# Authorization: {{authToken}}

# =========================================
# Invoice Management
# (Scoped to a company)
# =========================================

### Create an invoice
POST http://127.0.0.1:8080/api/companies/{{companyId}}/invoices
Authorization: {{authToken}}
Content-Type: application/json

{
  "customer_name": "ACME Corp",
  "customer_email": "billing@acme.com",
  "customer_address": "123 Innovation Drive, Tech City",
  "issue_date": "2023-03-15",
  "due_date": "2023-04-14",
  "status": "Draft",
  "notes": "Project Alpha deliverables"
  # "user_id": 1, # Backend should fill this with authenticated user's ID
  "items": [
    {
      "item_id": {{inventoryItemId}}, # Assuming inventoryItemId is set from previous inventory creation
      "item_description": "Super Widget - Project Alpha", # Can override or be fetched
      "quantity": 5,
      "unit_price": 25.99
    },
    {
      "item_description": "Custom Development Hours",
      "quantity": 10,
      "unit_price": 75.00
    }
  ]
}
@invoiceId = {{create_invoice.response.body.id}}

### Get all invoices
GET http://127.0.0.1:8080/api/companies/{{companyId}}/invoices
Authorization: {{authToken}}

### Get a specific invoice
GET http://127.0.0.1:8080/api/companies/{{companyId}}/invoices/{{invoiceId}}
Authorization: {{authToken}}

### Update an invoice (e.g., change status and add a note)
PUT http://127.0.0.1:8080/api/companies/{{companyId}}/invoices/{{invoiceId}}
Authorization: {{authToken}}
Content-Type: application/json

{
  "status": "Sent",
  "notes": "Project Alpha deliverables. Sent to client."
}

### Update an invoice (e.g., change items - this replaces all items)
PUT http://127.0.0.1:8080/api/companies/{{companyId}}/invoices/{{invoiceId}}
Authorization: {{authToken}}
Content-Type: application/json

{
  "customer_name": "ACME Corp International",
  "status": "Sent",
  "items": [
    {
      "item_id": {{inventoryItemId}},
      "item_description": "Super Widget - Project Alpha (Revised)",
      "quantity": 6,
      "unit_price": 25.99
    },
    {
      "item_description": "Extended Support Hours",
      "quantity": 2,
      "unit_price": 100.00
    }
  ]
}

### Delete an invoice
# DELETE http://127.0.0.1:8080/api/companies/{{companyId}}/invoices/{{invoiceId}}
# Authorization: {{authToken}}


# =========================================
# Reports (Scoped to a company)
# =========================================

### Get Profit and Loss Report
GET http://127.0.0.1:8080/api/companies/{{companyId}}/reports/profit_and_loss?start_date=2023-01-01&end_date=2023-03-31
Authorization: {{authToken}}

### Get Sales Report
GET http://127.0.0.1:8080/api/companies/{{companyId}}/reports/sales_report?start_date=2023-01-01&end_date=2023-03-31
Authorization: {{authToken}}

### Get Expense Report
GET http://127.0.0.1:8080/api/companies/{{companyId}}/reports/expense_report?start_date=2023-01-01&end_date=2023-03-31
Authorization: {{authToken}}

### Get Inventory Summary Report
GET http://127.0.0.1:8080/api/companies/{{companyId}}/reports/inventory_summary
Authorization: {{authToken}}

### Get Employee Payroll Summary
GET http://127.0.0.1:8080/api/companies/{{companyId}}/reports/employee_payroll?start_date=2023-01-01&end_date=2023-03-31
Authorization: {{authToken}}


### Update My Password
PUT http://127.0.0.1:8080/api/users/me/password
Authorization: {{authToken}} # Make sure authToken is set from login
Content-Type: application/json

{
  "old_password": "password123",
  "new_password": "newsecurepassword456"
}

### Promote a user to System Admin (Requires System Admin Auth)
# Replace {{userIdToPromote}} with the ID of the user you want to promote
POST http://127.0.0.1:8080/api/users/{{userIdToPromote}}/promote-to-system-admin
Authorization: {{authToken}} # Use a token for a SYSTEM_ADMIN user
